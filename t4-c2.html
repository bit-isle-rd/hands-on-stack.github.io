<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>FogとChefを使ったアプリケーションデプロイ</title>
    <!-- Styles -->

    <link rel="stylesheet" media="print" href="file:///home/student18/hands-on-stack.github.io/theme/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="file:///home/student18/hands-on-stack.github.io/theme/css/screen.css">


    <!-- /Styles -->
    <!-- Javascripts -->

    <script type="text/javascript" src="file:///home/student18/hands-on-stack.github.io/theme/js/slides.js"></script>


    <!-- /Javascripts -->
</head>
<body>
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">

      <!-- slide source: t4-c2.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h1>FogとChefを使ったアプリケーションデプロイ</h1></header>


          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="t4-c2.rst">t4-c2.rst</a>
            </aside>

            <aside class="page_number">
              1/9
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: t4-c2.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h1>概要</h1></header>


            <section><ul class="simple">
<li>ここではFogを用いて仮想マシンを複数台作成し、役割に応じてChefでデプロイを行います。</li>
<li>作成されるサーバは以下の通りです。studentXXの部分には、操作端末の番号が割り当てられます。<ul>
<li>studentXXlb1 : 掲示板アプリのロードバランササーバー1</li>
<li>studentXXweb1 : 掲示板アプリのフロントWebサーバー1</li>
<li>studentXXweb2 : 掲示板アプリのフロントWebサーバー2</li>
<li>studentXXapp1 : 掲示板アプリのアプリサーバー</li>
<li>studentXXdb1 : 掲示板アプリのデータベースサーバー</li>
</ul>
</li>
</ul></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="t4-c2.rst">t4-c2.rst</a>
            </aside>

            <aside class="page_number">
              2/9
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: t4-c2.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h1>操作環境の準備</h1></header>


            <section><ul class="simple">
<li>下記のコマンドで、Fogが導入された操作用仮想マシンを用意します。<ul>
<li>コマンドの実行が完了するまで数分かかります。</li>
</ul>
</li>
</ul>
<p>コマンド実行の様子:</p>
<pre class="literal-block">
---------ここから---------
$ cd /opt/support/t4-c2
$ ./01_init.sh
(中略)

####init.sh finished. Please login to fog-server by following command
ssh -i ~/default.pem -oStrictHostKeyChecking=no fog&#64;IPアドレス
---------ここまで---------
</pre></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="t4-c2.rst">t4-c2.rst</a>
            </aside>

            <aside class="page_number">
              3/9
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: t4-c2.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h1>操作用仮想マシンへのログイン</h1></header>


            <section><ul class="simple">
<li>最後に表示されたsshコマンドで、操作用仮想マシンにログインします。</li>
</ul>
<p>コマンド実行:</p>
<pre class="literal-block">
---------ここから---------
$ ssh -i ~/default.pem -oStrictHostKeyChecking=no fog&#64;IPアドレス
---------ここまで---------
</pre></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="t4-c2.rst">t4-c2.rst</a>
            </aside>

            <aside class="page_number">
              4/9
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: t4-c2.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h1>仮想マシンの作成とアプリケーションデプロイの実行(1)</h1></header>


            <section><ul class="simple">
<li>Fogが導入された仮想マシンを起動して下記のスクリプトを実行すると、仮想マシンが作成されます。その後、各サーバーにアプリケーションに必要な機能がデプロイされ、掲示板アプリが利用可能になります。</li>
</ul>
<p>コマンド実行:</p>
<pre class="literal-block">
---------ここから---------
$ ~/deploy_app.sh
---------ここまで---------
</pre></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="t4-c2.rst">t4-c2.rst</a>
            </aside>

            <aside class="page_number">
              5/9
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: t4-c2.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h1>仮想マシンの作成とアプリケーションデプロイの実行(2)</h1></header>


            <section><ul>
<li><p class="first">コマンドを実行すると、以下のような流れで処理が進みます</p>
<p>-サーバを作成するのに必要なデータは、yamlファイルで管理されます。そのため、 本デモではコマンド実行時にまずyamlファイルを作成します。作成されたyamlファイルは、$HOMEディレクトリにありますので、アプリケーションデプロイ後、確認することもできます。</p>
<ul class="simple">
<li>yamlで定義された役割に応じて仮想マシンを作成します。完了すると『Create server studentXXdb1』と表示されます。</li>
<li>作成したサーバーとicmpでの疎通ができるまで一定間隔でポーリングを繰り返します。疎通が取れると、『I found icmp session to student18db1』と表示され先に進みます。</li>
<li>作成した全てのサーバとの疎通が確認できた時点で、Chefによるデプロイが開始されます。Chefサーバに必要なcookbookとroleがアップロードされ、デプロイを実行します。</li>
<li>デプロイが完了すると、実行ログのパスが表示されます。全てのサーバに対してデプロイが完了すると、処理を終了します。</li>
<li>また、最後にアプリケーションにアクセスするためのURLが表示されます。studentXXlb1サーバのローカルIPアドレスは、nova listコマンドで確認ください。</li>
</ul>
</li>
</ul>
<p>ログ:</p>
<pre class="literal-block">
---------ここから---------
Created server student18db1
(中略)
waiting icmp session to student18db1
I found icmp session to student18db1
(中略)
cookbooks uploaded.
roles uploaded.
(中略)
deploy finished =&gt; student18db1
check logfile =&gt; more /tmp/student18db1_bootstrap.log
deploy finished =&gt; student18web1
check logfile =&gt; more /tmp/student18web1_bootstrap.log
(中略)
Deploy finished. TRY w3m http://'local-ip-address-of-student18lb1' from this server
---------ここまで---------
</pre></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="t4-c2.rst">t4-c2.rst</a>
            </aside>

            <aside class="page_number">
              6/9
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: t4-c2.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h1>構築した環境の全体像</h1></header>


            <section><ul class="simple">
<li>今回、構築した環境は下図のようになります。<ul>
<li>「OpenStackクラウドインテグレーション」図 12-2-2 OpenStack/AWS への Write Once Deploy Anywhere より引用</li>
</ul>
</li>
</ul></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="t4-c2.rst">t4-c2.rst</a>
            </aside>

            <aside class="page_number">
              7/9
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: t4-c2.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h1>環境の削除</h1></header>


            <section><ul class="simple">
<li>起動した仮想マシンをすべて削除します。</li>
<li>下記のように、操作用仮想マシンからログアウトして、仮想マシンを削除するスクリプトを実行します。</li>
</ul>
<p>コマンド実行:</p>
<pre class="literal-block">
---------ここから---------
$ exit
$ /opt/support/t4-c2/99_cleanup.sh
---------ここまで---------
</pre></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="t4-c2.rst">t4-c2.rst</a>
            </aside>

            <aside class="page_number">
              8/9
            </aside>
          </footer>
        </div>
      </div>

      <!-- slide source: t4-c2.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">

            <header><h1>まとめ</h1></header>


            <section><ul class="simple">
<li>本スクリプトは、ソースは全く同じまま、yamlのデータを変更することでAWSやOpenstackといったパブリッククラウドの違いを意識せずに同じアプリのデプロイが可能です。ここでは、Openstackのデモを行いましたが、本著では、 AWSでの手順も紹介していますので是非試してみてください。</li>
<li>本著では、Fogを利用したスクリプトに関する詳細な解説があります。詳しい処理内容にご興味がありましたら、本著をご確認ください。 もしくは、 github上からソースコードを取得することも可能です。</li>
</ul></section>

          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>

            </section>
          </div>
          <footer>

            <aside class="source">
              Source: <a href="t4-c2.rst">t4-c2.rst</a>
            </aside>

            <aside class="page_number">
              9/9
            </aside>
          </footer>
        </div>
      </div>

    </div>
  </div>

  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>

      <tr id="toc-row-1">
        <th><a href="#slide1">FogとChefを使ったアプリケーションデプロイ</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>


      <tr id="toc-row-2">
        <th><a href="#slide2">概要</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>


      <tr id="toc-row-3">
        <th><a href="#slide3">操作環境の準備</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>


      <tr id="toc-row-4">
        <th><a href="#slide4">操作用仮想マシンへのログイン</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>


      <tr id="toc-row-5">
        <th><a href="#slide5">仮想マシンの作成とアプリケーションデプロイの実行(1)</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>


      <tr id="toc-row-6">
        <th><a href="#slide6">仮想マシンの作成とアプリケーションデプロイの実行(2)</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>


      <tr id="toc-row-7">
        <th><a href="#slide7">構築した環境の全体像</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>


      <tr id="toc-row-8">
        <th><a href="#slide8">環境の削除</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>


      <tr id="toc-row-9">
        <th><a href="#slide9">まとめ</a></th>
        <td><a href="#slide9">9</a></td>
      </tr>


    </table>
  </div>

  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>
